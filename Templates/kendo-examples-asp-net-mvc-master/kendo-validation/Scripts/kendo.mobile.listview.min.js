/*
* Kendo UI Complete v2012.3.1114 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
(function(e){function t(t){var l=e(t.target).find("input"),n=!l[0].checked;l.is(":radio")&&(n=!0),l.attr("checked",n).trigger("change")}function l(){return this.nodeType===s.TEXT_NODE&&this.nodeValue.match(L)}function n(e,t){t&&e.prepend('<span class="km-icon km-'+t+'"/>')}function a(e){n(e,m(e,"icon"))}function i(e){var t=e.parent(),a=e.add(t.children(r.roleSelector("detailbutton"))),i=t.contents().not(a).not(l);i.length||(e.addClass("km-listview-link").attr(r.attr("role"),"listview-link"),n(e,m(t,"icon")))}function o(e){if(e.children("input[type=checkbox],input[type=radio]").length){var t=e.parent();t.contents().not(e).not(function(){return 3==this.nodeType})[0]||e.addClass("km-listview-label")}}var r=window.kendo,s=window.Node,d=r.mobile,c=d.ui,u=r.support,h=r.data.DataSource,p=c.Widget,f=".km-list > li, > li",_=".km-listview-link, .km-listview-label",g=e.proxy,m=r.attrValue,v="km-group-title",k="km-state-active",S='<div class="'+v+'"><div class="km-text"></div></div>',T=r.template('<li><div class="'+v+'"><div class="km-text">#= this.headerTemplate(data) #</div></div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),w='<div class="km-listview-wrapper" />',b=".kendoMobileListView",H="lastPageReached",y="click",x=y+b,I="change",R="requestStart",C="function",L=/^\s+$/,B=/button/,D=p.extend({init:function(e,l){var n=this;p.fn.init.call(n,e,l),e=n.element,l=n.options,e.on("down",_,"_highlight").on("move up cancel",_,"_dim").on("up",f,"_click"),u.touch&&e.on("up",".km-listview-label",t),e.wrap(w),n.wrapper=n.element.parent(),n._footer(),n._dataSource(),n._bindScroller(),n._fixHeaders(),l.dataSource&&n.options.autoBind?n.dataSource.fetch():n._style(),r.notify(n,c)},events:[y,H],options:{name:"ListView",style:"",type:"flat",autoBind:!0,fixedHeaders:!1,template:"#:data#",headerTemplate:'<span class="km-text">#:value#</span>',appendOnRefresh:!1,loadMore:!1,loadMoreText:"Press to load more",endlessScroll:!1,scrollTreshold:30,pullToRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",pullOffset:140},setOptions:function(e){p.fn.setOptions.call(this,e)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},destroy:function(){var e=this;p.fn.destroy.call(e),e._unbindDataSource(),e.stopEndlessScrolling(),e.stopLoadMore(),r.destroy(e.element)},refresh:function(t){t=t||{};var l,n,a,i=this,o=i.element,s=i.options,u=i.dataSource,h=u.view(),p=i.loading,f="html";return"itemchange"===t.action?(n=t.items[0],a=e(i.template(n)),o.find("[data-"+r.ns+"uid="+n.uid+"]").replaceWith(a),i.trigger("itemChange",{item:a,data:n,ns:c}),i._style(),undefined):(i.template||i._templates(),i._cacheDataItems(h),i.trigger("dataBinding"),u.group()[0]?(s.type="group",l=r.render(i.groupTemplate,h)):l=r.render(i.template,h),p?f="append":s.appendOnRefresh&&(f="prepend"),o[f](l),"html"===f?d.init(o.children()):d.init(e(l)),p&&(i.loading=!1,i._calcTreshold(),i._toggleLoader(!1)),s.pullToRefresh&&i._scroller().pullHandled(),i._hideLoading(),i._shouldFixHeaders(),i._style(),i.trigger("dataBound",{ns:c}),undefined)},_cacheDataItems:function(e){var t,l=this;l.element[0].firstChild||(l._firstOrigin=l._first=e[0],l._last=e[e.length-1]),l._pulled&&(t=e[0],l._pulled=!1,t&&(l._first=t)),l.loading&&(t=e[e.length-1],t&&(l._last=t))},items:function(){return"group"===this.options.type?this.element.find(".km-list").children():this.element.children()},stopEndlessScrolling:function(){var e=this,t=e._scroller();t&&e._loadIcon&&(e.loading=!1,e._loadIcon.parent().hide(),t.unbind("resize",e._scrollerResize).unbind("scroll",e._scrollerScroll),e.trigger(H))},stopLoadMore:function(){var e=this;e._loadButton&&(e.loading=!1,e._loadButton.off(x).parent().hide(),e.trigger(H))},_dim:function(e){this._toggle(e,!1)},_highlight:function(e){this._toggle(e,!0)},_toggle:function(t,l){if(!(t.which>1)){var n=e(t.currentTarget),a=n.parent(),i=m(n,"role")||"",o=!i.match(B),r=t.isDefaultPrevented();o&&a.toggleClass(k,l&&!r)}},_unbindDataSource:function(){var e=this;e.dataSource.unbind(I,e._refreshHandler).unbind(R,e._requestStartHandler)},_dataSource:function(){var e=this,t=e.options;e.dataSource&&e._refreshHandler?e._unbindDataSource():(e._refreshHandler=g(e.refresh,e),e._requestStartHandler=g(e._showLoading,e)),e.dataSource=h.create(t.dataSource).bind(I,e._refreshHandler),t.pullToRefresh||t.loadMore||t.endlessScroll||e.dataSource.bind(R,e._requestStartHandler)},_fixHeader:function(t){var l,n,a,i=0,o=this,r=o._scroller(),s=t.scrollTop,d=o.headers;if(o.fixedHeaders){do{if(l=d[i++],!l){a=e("<div />");break}n=l.offset,a=l.header}while(n>s);o.currentHeader!=i&&(r.fixedContainer.html(a.clone()),o.currentHeader=i)}},_shouldFixHeaders:function(){this.fixedHeaders="group"===this.options.type&&this.options.fixedHeaders},_cacheHeaders:function(){var t=this,l=[];t.fixedHeaders&&(t.element.find("."+v).each(function(t,n){n=e(n),l.unshift({offset:n.position().top,header:n})}),t.headers=l,t._fixHeader({scrollTop:0}))},_fixHeaders:function(){var e=this,t=e._scroller();e._shouldFixHeaders(),t&&(r.onResize(function(){e._cacheHeaders()}),t.bind("scroll",function(t){e._fixHeader(t)}))},_bindScroller:function(){var e=this,t=e.options,l=e.dataSource,n=e._scroller();n&&(t.pullToRefresh&&n.setOptions({pullToRefresh:!0,pull:function(){var n=t.pullParameters,a={page:1};n&&(a=n.call(e,e._first)),e._pulled=!0,l.read(a)},pullTemplate:t.pullTemplate,releaseTemplate:t.releaseTemplate,refreshTemplate:t.refreshTemplate}),t.endlessScroll&&(e._scrollHeight=n.element.height(),e._scrollerResize=function(){e._scrollHeight=n.element.height(),e._calcTreshold()},e._scrollerScroll=function(t){!e.loading&&t.scrollTop+e._scrollHeight>e._treshold&&e._nextPage()},n.setOptions({resize:e._scrollerResize,scroll:e._scrollerScroll})))},_calcTreshold:function(){var e=this,t=e._scroller();t&&(e._treshold=t.scrollHeight()-e.options.scrollTreshold)},_nextPage:function(){var e,t=this,l=t.options,n=l.endlessScrollParameters||l.loadMoreParameters;t.loading=!0,t._toggleLoader(!0),n&&(e=n.call(t,t._firstOrigin,t._last)),t.dataSource.next(e)||(t.stopLoadMore(),t.stopEndlessScrolling())},_templates:function(){var e=this,t=e.options.template,l=e.options.headerTemplate,n=' data-uid="#=data.uid || ""#"',a={},i={};typeof t===C&&(a.template=t,t="#=this.template(data)#"),i.template=e.template=g(r.template("<li"+n+">"+t+"</li>"),a),typeof l===C&&(i._headerTemplate=l,l="#=this._headerTemplate(data)#"),i.headerTemplate=r.template(l),e.groupTemplate=g(T,i)},_click:function(t){if(!(t.which>1||t.isDefaultPrevented())){var l,n=this,a=e(t.currentTarget),i=e(t.target),o=i.closest(r.roleSelector("button","detailbutton","backbutton")),s=r.widgetInstance(o,c),d=a.attr(r.attr("uid"));d&&(l=n.dataSource.getByUid(d)),n.trigger(y,{target:i,item:a,dataItem:l,button:s})&&t.preventDefault()}},_style:function(){var t=this,l=t.options,n="group"===l.type,a=t.element,i="inset"===l.style;a.addClass("km-listview").toggleClass("km-list",!n).toggleClass("km-listinset",!n&&i).toggleClass("km-listgroup",n&&!i).toggleClass("km-listgroupinset",n&&i),n&&(a.children().children("ul").addClass("km-list"),a.children("li").each(function(){var t=e(this).contents().first();t.is("ul")||t.is("div."+v)||t.wrap(S)})),t._enhanceItems(),a.parents(".km-listview")[0]||a.closest(".km-content").toggleClass("km-insetcontent",i),t._cacheHeaders()},_enhanceItems:function(){this.items().each(function(){var t,l=e(this),n=!1;l.children().each(function(){t=e(this),t.is("a")?(i(t),n=!0):t.is("label")&&(o(t),n=!0)}),n||a(l)})},_footer:function(){var t,l=this,n=l.options,a=n.loadMore;(a||n.endlessScroll)&&(l._loadIcon=e('<span style="display:none" class="km-icon"></span>'),t=e('<span class="km-load-more"></span>').append(l._loadIcon),a&&(l._loadButton=e('<button class="km-load km-button">'+n.loadMoreText+"</button>").on(x,g(l._nextPage,l)),t.append(l._loadButton)),l.wrapper.append(t))},_toggleLoader:function(e){var t=this,l=t._loadIcon,n=t._loadButton;n&&n.toggle(!e),e?l.css("display","block"):l.hide()},_scroller:function(){var e,t=this;return t._scrollerInstance||(e=t.view(),t._scrollerInstance=e&&e.scroller),t._scrollerInstance},_showLoading:function(){var e=this.view();e&&e.loader.show()},_hideLoading:function(){var e=this.view();e&&e.loader.hide()}});c.plugin(D)})(window.kendo.jQuery);